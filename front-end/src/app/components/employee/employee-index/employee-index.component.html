<div class="card-body">
  <div class="search-filter-container">
    <!-- Search Bar -->
    <div class="search-bar">
      <input type="text" [(ngModel)]="searchText" placeholder="Search..." />
      <button class="search-icon">
        <i class="fas fa-search"></i>
      </button>
      <button class="filter-button" (click)="toggleFilterPanel()">
        <i class="bi bi-filter"></i> Filter
      </button>
    </div>

    <!-- Filter Panel -->
    <div class="filter-panel" *ngIf="isFilterVisible">
      <div class="filter-section">
        <!-- Role Filter -->
        <div class="filter-group">
          <h4 (click)="toggleDropdown('role')">Role</h4>
          <div class="dropdown-content scrollable" *ngIf="activeDropdown === 'role'">
            <div *ngFor="let role of uniqueRoles" (click)="updateFilter('role', role)">
              <input type="checkbox" [checked]="selectedRole.includes(role)" /> {{ role }}
            </div>
          </div>
        </div>

        <!-- Project Filter -->
        <div class="filter-group">
          <h4 (click)="toggleDropdown('project')">Projects</h4>
          <div class="dropdown-content scrollable" *ngIf="activeDropdown === 'project'">
            <div *ngFor="let project of uniqueProjects" (click)="updateFilter('project', project)">
              <input type="checkbox" [checked]="selectedProject.includes(project)" /> {{ project }}
            </div>
          </div>
        </div>

        <!-- Team Filter -->
        <div class="filter-group">
          <h4 (click)="toggleDropdown('team')">Teams</h4>
          <div class="dropdown-content scrollable" *ngIf="activeDropdown === 'team'">
            <div *ngFor="let team of uniqueTeams" (click)="updateFilter('team', team)">
              <input type="checkbox" [checked]="selectedDepartment.includes(team)" /> {{ team }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cards Display -->
  <div class="row" [ngClass]="{'filter-active': isFilterVisible}">
    <div class="col-12 col-md-4 mb-4" *ngFor="let employee of filterEmployee()">
      <div class="card">
        <div class="card-body">
          <!-- Employee Skills -->
          <div class="div-em-skill">
            <ul>
              <li *ngFor="let skill of employee.skills" class="skill-item">
                {{ skill.trim() }}
              </li>
            </ul>
          </div>

          <!-- Employee Name -->
           <div *ngIf="validateUserPrivilege(); else cantclickName">
            <h5 class="card-title">
              <a [routerLink]="['/dashboard/employee/update', employee.id]">
                {{ employee.firstname + ' ' + employee.lastname }}
              </a>
            </h5>
           </div>
           <ng-template #cantclickName>
            <h5 class = "card-title" >
            {{employee.firstname + " " + employee.lastname}}
            </h5>
           </ng-template>


          <!-- Employee Image and Details (grid layout) -->
          <div class="row employee-info">
            <!-- Employee Image -->
            <div class="col-12 col-md-4 employee-image">
              <img src="http://localhost:3000/upload-picture/{{employee.avatar}}" alt="Employee Avatar" class="avatar">
            </div>

            <!-- Employee Details (email, team, project) -->
            <div class="col-12 col-md-8 employee-details">
              <p class="card-text"><strong>Email:</strong> {{ employee.email }}</p>

              <!-- Team -->
              <div *ngIf="validateUserPrivilege(); else userTeam">
                <p class="card-text">
                  <strong>Team:</strong>
                  <span *ngIf="employee.department?.id; else noTeam">
                    <a [routerLink]="['/dashboard/department/update', employee.department?.id]">
                      {{ employee.department?.name }}
                    </a>
                  </span>
                  <ng-template #noTeam>Don't have Team</ng-template>
                </p>
              </div>
              <ng-template #userTeam>
                <p class="card-text">
                  <strong>Team:</strong>
                  <span *ngIf="employee.department?.id; else noTeam">
                      {{ employee.department?.name }}
                  </span>
                  <ng-template #noTeam>Don't have Team</ng-template>
                </p>
              </ng-template>


              <!-- Project -->
              <div *ngIf="validateUserPrivilege(); else userProject">
                <p class="card-text">
                  <strong>Project:</strong>
                  <span *ngIf="employee.project?.id; else noProject">
                    <a [routerLink]="['/dashboard/project/update', employee.project?.id]">
                      {{ employee.project?.name }}
                    </a>
                  </span>
                  <ng-template #noProject>Don't have project</ng-template>
                </p>
              </div>
              <ng-template #userProject>
                <p class="card-text">
                  <strong>Project:</strong>
                  <span *ngIf="employee.project?.id; else noProject">
                    {{employee.project?.name}}
                  </span>
                  <ng-template #noProject>Don't have project</ng-template>
                </p>
              </ng-template>
            </div>
          </div>

          <!-- Button -->
            <div class = "row" *ngIf="validateUserPrivilege(); else noPrivilege">
              <div class = "col-6" >
                  <button [routerLink]="['/dashboard/employee/update', employee.id]" class="view-profile-btn">
                    View Details
                  </button>
              </div>
              <div class = "col-6">
                  <button [routerLink]="['/dashboard/employee/expertProfile', employee.id]" class="view-profile-btn">
                    View EP
                  </button>
              </div>
          </div>
          <ng-template #noPrivilege>
            <div class = "row">
              <div class = "col">
                <button [routerLink]="['/dashboard/employee/expertProfile', employee.id]" class="view-profile-btn">
                  View EP
                </button>
              </div>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>
